<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y√™uu emmmmm üíï</title>
    <style>
        /* ========== C√ÅC BI·∫æN CSS ========== */
:root {
    /* M√†u s·∫Øc ch·ªß ƒë·∫°o */
    --pink-primary: #ff6b9d;    /* M√†u h·ªìng ch√≠nh */
    --pink-light: #ffb3c8;      /* M√†u h·ªìng nh·∫°t */
    --pink-lighter: #ffd6e7;    /* M√†u h·ªìng r·∫•t nh·∫°t */
    --white: #ffffff;           /* M√†u tr·∫Øng */
    --text-dark: #4a2a3a;       /* M√†u ch·ªØ t·ªëi */
    --text-light: #fff;         /* M√†u ch·ªØ s√°ng */
    --shadow-soft: 0 4px 15px rgba(0, 0, 0, 0.1); /* Hi·ªáu ·ª©ng b√≥ng m·ªÅm */
}

/* ========== STYLE CHUNG ========== */
body {
    background: linear-gradient(135deg, var(--pink-light), var(--white));
    background-attachment: fixed;
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: var(--text-dark);
    line-height: 1.6;
    margin: 0;
    padding: 20px;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
}

/* Wrapper ch·ª©a n·ªôi dung ch√≠nh */
.content-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
}

/* ========== PH·∫¶N C√ÇU H·ªéI ========== */
.question {
    font-size: 28px;
    margin: 0 0 40px 0;
    color: var(--pink-primary);
    font-weight: bold;
    text-align: center;
    width: 100%;
    padding: 0 20px;
}

/* ========== PH·∫¶N L·ª∞A CH·ªåN (N√öT B·∫§M) ========== */
.options {
    display: flex;
    justify-content: center;
    gap: 25px;
    margin-bottom: 80px;
    position: relative;
    z-index: 1;
    margin-top: 30px;
}

/* Style chung cho c√°c n√∫t l·ª±a ch·ªçn */
.option {
    padding: 15px 45px;
    font-size: 20px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    box-shadow: var(--shadow-soft);
    font-weight: bold;
    position: relative;
}

/* N√∫t ƒë·ªìng √Ω */
.yes {
    background-color: #4caf50; /* M√†u xanh l√° */
    color: white;
    border: 2px solid #4caf50;
}

/* N√∫t t·ª´ ch·ªëi */
.no {
    background-color: #f44336; /* M√†u ƒë·ªè */
    color: white;
    border: 2px solid #f44336;
}

/* Hi·ªáu ·ª©ng khi hover v√†o n√∫t */
.option:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

/* ========== PH·∫¶N H√åNH ·∫¢NH ========== */
.media-container {
    width: 100%;
    max-width: 500px;
    margin: 20px auto;
    display: flex;
    justify-content: center;
}

.media-content {
    max-width: 100%;
    max-height: 300px;
    border-radius: 50%; /* Bo tr√≤n h√¨nh ·∫£nh */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease;
}

.media-content:hover {
    transform: scale(1.05); /* Ph√≥ng to nh·∫π khi hover */
}

/* ========== POPUP CH√çNH ========== */
.popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* N·ªÅn m·ªù ƒëen */
    z-index: 100;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.5s; /* Hi·ªáu ·ª©ng xu·∫•t hi·ªán */
}

.popup-content {
    background-color: white;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    max-width: 80%;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    transform: scale(0);
    animation: zoomIn 0.5s forwards; /* Hi·ªáu ·ª©ng ph√≥ng to */
    position: relative;
}

.popup-content h2 {
    color: var(--pink-primary);
    margin-bottom: 20px;
    font-size: 24px;
}

.popup-content p {
    margin-bottom: 15px;
    font-size: 18px;
}

/* √î nh·∫≠p tin nh·∫Øn */
.input-message {
    width: 100%;
    padding: 12px;
    margin: 15px 0;
    border: 2px solid var(--pink-lighter);
    border-radius: 10px;
    font-size: 16px;
    min-height: 25px;
    transition: border 0.3s;
    resize: vertical; /* Cho ph√©p thay ƒë·ªïi k√≠ch th∆∞·ªõc theo chi·ªÅu d·ªçc */
}

.input-message:focus {
    border-color: var(--pink-primary);
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 77, 141, 0.2);
}

/* N√∫t g·ª≠i */
.submit-btn {
    background-color: var(--pink-primary);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
    margin-top: 10px;
}

.submit-btn:hover {
    background-color: #e84379;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.submit-btn:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* N√∫t ƒë√≥ng popup */
.popup-close {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 24px;
    cursor: pointer;
    color: #888;
    transition: color 0.3s;
}

.popup-close:hover {
    color: var(--pink-primary);
}

/* ========== POPUP TH√ÄNH C√îNG ========== */
#successPopup .popup-content {
    max-width: 500px;
    width: 90%;
    padding: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    animation: zoomIn 0.5s forwards, bounce 0.5s 0.5s forwards, pulse 2s infinite 0.5s;
    position: relative;
}

/* Vi·ªÅn trang tr√≠ cho popup */
#successPopup .popup-content::before {
    content: "";
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    border: 2px dashed var(--pink-primary);
    border-radius: 25px;
    opacity: 0.3;
    pointer-events: none;
}

#successMessage {
    font-size: 18px;
    padding: 20px;
    background-color: var(--pink-lighter);
    border-radius: 15px;
    margin: 20px 0;
    width: 100%;
    line-height: 1.6;
}

#successPopup h2 {
    font-size: 28px;
    margin-bottom: 25px;
}

#successPopup .popup-image {
    width: 200px;
    height: 200px;
    object-fit: cover;
    border: 5px solid var(--pink-lighter);
    margin: 15px 0;
    box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
}

/* N√∫t OK trong popup th√†nh c√¥ng */
#okBtn {
    padding: 15px 40px;
    font-size: 18px;
    margin-top: 20px;
    background: linear-gradient(45deg, var(--pink-primary), #ff8fab);
    color: white;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
    transition: all 0.3s;
}

#okBtn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255, 107, 157, 0.6);
}

/* ========== HI·ªÜU ·ª®NG CONFETTI ========== */
.confetti {
    position: fixed;
    top: -10px;
    width: 10px;
    height: 10px;
    background-color: #f00;
    border-radius: 50%;
    animation: confetti 3s linear forwards;
    z-index: 1001;
}

/* ========== SPINNER LOADING ========== */
.spinner {
    display: none;
    width: 40px;
    height: 40px;
    margin: 10px auto;
    border: 4px solid #f3f3f3;
    border-top: 4px solid var(--pink-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

/* ========== FOOTER ========== */
.author-lh-footer {
    text-align: center;
    margin-top: 1px;
    padding: 15px;
    color: var(--pink-primary);
    font-size: 14px;
    opacity: 0.8;
    transition: opacity 0.3s;
}

.author-lh-footer:hover {
    opacity: 1;
}

.author-lh-footer a {
    color: var(--pink-primary);
    text-decoration: none;
    font-weight: bold;
}

.author-lh-footer a:hover {
    text-decoration: underline;
}

/* ========== POPUP H·ª¶Y ========== */
#cancelPopup .popup-content {
    max-width: 500px;
    width: 90%;
    padding: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    animation: zoomIn 0.5s forwards;
    position: relative;
}

#cancelMessage {
    font-size: 18px;
    padding: 20px;
    background-color: var(--pink-lighter);
    border-radius: 15px;
    margin: 20px 0;
    width: 100%;
    line-height: 1.6;
}

/* N√∫t OK trong popup h·ªßy */
#cancelOkBtn {
    padding: 15px 40px;
    font-size: 18px;
    background: linear-gradient(45deg, var(--pink-primary), #ff8fab);
    color: white;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    margin-top: 20px;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
}

/* ========== POPUP L·ªñI ========== */
#errorPopup .popup-content {
    max-width: 500px;
    width: 90%;
    padding: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    animation: zoomIn 0.5s forwards;
    position: relative;
}

#errorMessage {
    font-size: 18px;
    padding: 20px;
    background-color: #ffebee;
    border-radius: 15px;
    margin: 20px 0;
    width: 100%;
    line-height: 1.6;
    color: #d32f2f;
}

/* N√∫t OK trong popup l·ªói */
#errorOkBtn {
    padding: 15px 40px;
    font-size: 18px;
    background: linear-gradient(45deg, #f44336, #ff8fab);
    color: white;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    margin-top: 20px;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
}

/* ========== C√ÅC HI·ªÜU ·ª®NG ANIMATION ========== */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-20px); }
    60% { transform: translateY(-10px); }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    to { transform: scale(1); }
}

@keyframes confetti {
    0% { 
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
    }
    100% { 
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
    }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ========== RESPONSIVE DESIGN ========== */
@media (max-width: 600px) {
    .question {
        font-size: 22px;
        margin-bottom: 50px;
        padding-bottom: 20px;
    }

    .options {
        margin-top: 20px;
        margin-bottom: 60px;
        gap: 15px;
    }

    .option {
        font-size: 18px;
        padding: 12px 30px;
    }

    .media-content {
        max-height: 250px;
    }
    
    .popup-content {
        padding: 20px;
        max-width: 90%;
    }
    
    .popup-content h2 {
        font-size: 20px;
    }
    
    .popup-content p {
        font-size: 16px;
    }
    
    #successPopup .popup-content {
        max-width: 90%;
        padding: 25px;
    }

    #successMessage {
        font-size: 16px;
        padding: 12px;
    }

    #successPopup h2 {
        font-size: 24px;
    }
}
    </style>
</head>
<body>
    <div class="content-wrapper">
        <div class="question">C√¥ n√†ng xinh ƒë·∫πp c√≥ mu·ªën ƒëi ch∆°i v·ªõi t√¥i kh√¥ng?</div>
        
        <div class="options">
            <button class="option yes" id="yesButton">C√≥ ü´∂</button>
            <button class="option no" id="noButton">Kh√¥ng üòå</button>
        </div>
        
        <div class="media-container">
            <img class="media-content" src="https://lh3.googleusercontent.com/d/1KP_CKmUcTD6dZ3cifj51OxoxSQzG3i--" alt="·∫¢nh t√¨nh y√™u">
        </div>
    </div>

    <div class="popup" id="popup">
        <div class="popup-content">
            <span class="popup-close" id="closePopup">&times;</span>
            <h2>Yayyy! Em ƒë·ªìng √Ω r·ªìi n√® ‚ù§Ô∏è</h2>
            <p>Anh bi·∫øt ngay l√† em s·∫Ω ƒë·ªìng √Ω m√†! Ch√∫ng m√¨nh s·∫Ω c√≥ m·ªôt bu·ªïi h·∫πn h√≤ th·∫≠t tuy·ªát v·ªùi!</p>
           	<img class="popup-image" src="https://lh3.googleusercontent.com/d/1J_GsOkBTNhlLLEADAbwGcY3sDHu5JFAw" alt="·∫¢nh t√¨nh y√™u" width="125px">
            <p>H√£y vi·∫øt m·ªôt l·ªùi nh·∫Øn ng·ªçt ng√†o cho anh nh√© üíå</p>
            <textarea class="input-message" id="messageInput" 
                      placeholder="Vi·∫øt ƒëi·ªÅu em mu·ªën n√≥i v·ªõi anh v√†o ƒë√¢y n√®..."></textarea>
            <div class="spinner" id="spinner"></div>
            <button class="submit-btn" id="submitBtn" disabled>G·ª≠i cho anh</button>
        </div>
    </div>

    <div class="popup" id="successPopup">
        <div class="popup-content">
            <h2>Th√†nh c√¥ng! ‚ù§Ô∏è</h2>
            <div id="successMessage">
                <strong>Anh ƒë√£ nh·∫≠n ƒë∆∞·ª£c l·ªùi nh·∫Øn c·ªßa em r·ªìi üòò</strong>
                <div>‚ù§Ô∏è Y√™u em nhi·ªÅu! ‚ù§Ô∏è</div>
            </div>
          	<img class="popup-image" src="https://lh3.googleusercontent.com/d/1KUE3Helh5rUdB3WIkYPj7iFPFYQZby8e" alt="·∫¢nh t√¨nh y√™u">
            	<button class="ok-button" id="okBtn">OK</button>
        </div>
    </div>

    <div class="popup" id="cancelPopup">
        <div class="popup-content">
            <h2>Em kh√¥ng mu·ªën nh·∫Øn g√¨ cho anh sao? üòë</h2>
            <div id="cancelMessage">
                <strong>Anh s·∫Ω r·∫•t bu·ªìn n·∫øu em kh√¥ng nh·∫Øn g√¨...</strong>
                <div>N√™n l√† nh·∫Øn cho anh r·ªìi h·∫µng ƒëi nh√©! üòâ</div>
            </div>
            <img class="popup-image" src="https://lh3.googleusercontent.com/d/1KSIb58hYFPeJ9jW33C1_MFh3jarHEEMQ" alt="·∫¢nh bu·ªìn" width="125px">
            <button class="ok-button" id="cancelOkBtn">OK</button>
        </div>
    </div>

    <!-- Th√™m popup th√¥ng b√°o l·ªói -->
    <div class="popup" id="errorPopup">
        <div class="popup-content">
            <h2>Oops! C√≥ l·ªói x·∫£y ra üò¢</h2>
            <div id="errorMessage">
                <strong>Anh kh√¥ng nh·∫≠n ƒë∆∞·ª£c l·ªùi nh·∫Øn c·ªßa em r·ªìi...</strong>
                <div>Em th·ª≠ l·∫°i l·∫ßn n·ªØa nh√©! Anh ƒë·ª£i m√† ‚ù§Ô∏è</div>
            </div>
            <img class="popup-image" src="https://lh3.googleusercontent.com/d/1CryiQE7dHopOEqEqP_o0s4OwFk1jbVO1" alt="·∫¢nh bu·ªìn" width="125px">
            <button class="ok-button" id="errorOkBtn">Th·ª≠ l·∫°i</button>
        </div>
    </div>

    <footer class="author-lh-footer">
        Made with ‚ù§Ô∏è by <a href="https://www.facebook.com/lognhoagn.05" target="_blank">Long Ho√†ng</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // L·∫•y t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ DOM c·∫ßn thi·∫øt
    const elements = {
        noButton: document.getElementById('noButton'),
        yesButton: document.getElementById('yesButton'),
        popup: document.getElementById('popup'),
        closePopup: document.getElementById('closePopup'),
        mediaContainer: document.querySelector('.media-container'),
        messageInput: document.getElementById('messageInput'),
        submitBtn: document.getElementById('submitBtn'),
        spinner: document.getElementById('spinner'),
        successPopup: document.getElementById('successPopup'),
        successMessage: document.getElementById('successMessage'),
        okBtn: document.getElementById('okBtn'),
        cancelPopup: document.getElementById('cancelPopup'),
        cancelOkBtn: document.getElementById('cancelOkBtn'),
        errorPopup: document.getElementById('errorPopup'),
        errorMessage: document.getElementById('errorMessage'),
        errorOkBtn: document.getElementById('errorOkBtn')
    };

    // Object l∆∞u tr·∫°ng th√°i ·ª©ng d·ª•ng
    const state = {
        clickCount: 0,           // S·ªë l·∫ßn t∆∞∆°ng t√°c v·ªõi n√∫t "Kh√¥ng"
        currentScale: 1,         // T·ªâ l·ªá hi·ªán t·∫°i c·ªßa n√∫t "Kh√¥ng"
        yesScale: 1,             // T·ªâ l·ªá hi·ªán t·∫°i c·ªßa n√∫t "C√≥"
        isProcessing: false,     // C·ªù ki·ªÉm tra tr·∫°ng th√°i x·ª≠ l√Ω
        lastMessage: ''          // L∆∞u tin nh·∫Øn cu·ªëi c√πng ƒë·ªÉ th·ª≠ l·∫°i
    };

    // C√°c h·∫±ng s·ªë c·∫•u h√¨nh
    const MAX_CLICKS_BEFORE_HIDE = 9; // S·ªë l·∫ßn click t·ªëi ƒëa tr∆∞·ªõc khi ·∫©n n√∫t
    const COLORS = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4'];
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwUXhCjLCPLUAhfkMy9kZXXxzdTX5AANH1XruL5C3uPbJPnKWLnYK534BIOHS5sqRa-/exec";

    /* ========== C√ÅC H√ÄM X·ª¨ L√ù HI·ªÜU ·ª®NG ========== */

    // T·∫°o hi·ªáu ·ª©ng confetti
    function createConfetti() {
        const confettiCount = 100;
        for (let i = 0; i < confettiCount; i++) {
            setTimeout(() => createConfettiPiece(), i * 30);
        }
    }

    // T·∫°o t·ª´ng m·∫£nh confetti
    function createConfettiPiece() {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = '-10px';
        confetti.style.backgroundColor = COLORS[Math.floor(Math.random() * COLORS.length)];
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = Math.random() * 10 + 5 + 'px';
        confetti.style.animationDuration = Math.random() * 2 + 1 + 's';
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 8000);
    }

    /* ========== C√ÅC H√ÄM X·ª¨ L√ù N√öT "KH√îNG" ========== */

    // T√¨m v·ªã tr√≠ h·ª£p l·ªá ƒë·ªÉ di chuy·ªÉn n√∫t
    function findValidPosition(width, height, mediaRect) {
        const maxAttempts = 20;
        let attempts = 0;
        
        while (attempts < maxAttempts) {
            const x = Math.max(10, Math.random() * (window.innerWidth - width - 10));
            const y = Math.max(10, Math.random() * (window.innerHeight - height - 10));
            
            if (!checkOverlap(x, y, width, height, mediaRect)) {
                return { x, y };
            }
            attempts++;
        }
        
        return { 
            x: Math.max(10, Math.random() * (window.innerWidth - width - 10)),
            y: Math.max(10, Math.random() * (window.innerHeight - height - 10))
        };
    }

    // Ki·ªÉm tra v·ªã tr√≠ c√≥ ch·ªìng l·∫•n kh√¥ng
    function checkOverlap(x, y, width, height, mediaRect) {
        return (
            x + width > mediaRect.left && 
            x < mediaRect.right && 
            y + height > mediaRect.top && 
            y < mediaRect.bottom
        );
    }

    // ·∫®n n√∫t v·ªõi hi·ªáu ·ª©ng
    function hideButton(button) {
        if (!button) return;
        setTimeout(() => {
            button.style.transition = 'transform 0.5s ease-out';
            button.style.transform = 'scale(0)';
            button.style.pointerEvents = 'none';
            setTimeout(() => button.remove(), 500);
        }, 300);
    }

    // X·ª≠ l√Ω khi t∆∞∆°ng t√°c v·ªõi n√∫t "Kh√¥ng"
    function handleNoButtonAction(e) {
        e.preventDefault();
        if (state.isProcessing || !elements.noButton || !elements.yesButton) return;
        
        state.isProcessing = true;
        state.clickCount++;
        state.currentScale *= 0.85;
        state.yesScale *= 1.15;

        elements.noButton.style.transform = `scale(${state.currentScale})`;
        elements.yesButton.style.transform = `scale(${state.yesScale})`;

        const buttonRect = elements.noButton.getBoundingClientRect();
        const mediaRect = elements.mediaContainer.getBoundingClientRect();
        const newPosition = findValidPosition(
            buttonRect.width * state.currentScale, 
            buttonRect.height * state.currentScale, 
            mediaRect
        );

        elements.noButton.style.transition = 'all 0.3s ease-out';
        elements.noButton.style.position = 'fixed';
        elements.noButton.style.left = `${newPosition.x}px`;
        elements.noButton.style.top = `${newPosition.y}px`;

        if (state.clickCount >= MAX_CLICKS_BEFORE_HIDE) hideButton(elements.noButton);
        
        setTimeout(() => { state.isProcessing = false; }, 300);
    }

    /* ========== C√ÅC H√ÄM X·ª¨ L√ù POPUP ========== */

    // Hi·ªÉn th·ªã popup ch√≠nh
    function showPopup() {
        if (!elements.popup || !elements.noButton) return;
        
        // ·∫®n n√∫t "Kh√¥ng" v·ªõi hi·ªáu ·ª©ng
        elements.noButton.style.transition = 'opacity 0.3s ease';
        elements.noButton.style.opacity = '0';
        setTimeout(() => {
            elements.noButton.style.display = 'none';
        }, 300);
        
        elements.popup.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    // ƒê√≥ng popup ch√≠nh
    function closePopup() {
        if (!elements.popup) return;
        if (elements.messageInput) elements.messageInput.value = '';
        if (elements.submitBtn) elements.submitBtn.disabled = true;
        document.body.style.overflow = 'auto';
    }

    // Hi·ªÉn th·ªã popup th√†nh c√¥ng
    function showSuccessPopup() {
        elements.successPopup.style.display = 'flex';
        createConfetti();
    }

    // ·∫®n popup th√†nh c√¥ng v√† reset tr·∫°ng th√°i
    function hideSuccessPopup() {
        if (elements.successPopup) {
            elements.successPopup.style.display = 'none';
        }
        resetToInitialState();
    }

    // Hi·ªÉn th·ªã popup h·ªßy
    function showCancelPopup() {
        elements.cancelPopup.style.display = 'flex';
    }

    // ·∫®n popup h·ªßy
    function hideCancelPopup() {
        elements.cancelPopup.style.display = 'none';
    }

    // Hi·ªÉn th·ªã popup l·ªói
    function showErrorPopup() {
        elements.errorPopup.style.display = 'flex';
    }

    // ·∫®n popup l·ªói
    function hideErrorPopup() {
        elements.errorPopup.style.display = 'none';
        // Kh√¥i ph·ª•c tin nh·∫Øn c≈© ƒë·ªÉ ng∆∞·ªùi d√πng c√≥ th·ªÉ th·ª≠ l·∫°i
        if (elements.messageInput && state.lastMessage) {
            elements.messageInput.value = state.lastMessage;
            if (elements.submitBtn) elements.submitBtn.disabled = false;
        }
    }

    // Reset m·ªçi th·ª© v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu
    function resetToInitialState() {
        // Reset state
        state.clickCount = 0;
        state.currentScale = 1;
        state.yesScale = 1;
        state.isProcessing = false;
        state.lastMessage = '';
        
        // Reset n√∫t "Kh√¥ng"
        if (elements.noButton) {
            elements.noButton.style.display = '';
            elements.noButton.style.opacity = '1';
            elements.noButton.style.transform = 'scale(1)';
            elements.noButton.style.position = '';
            elements.noButton.style.left = '';
            elements.noButton.style.top = '';
            elements.noButton.style.transition = '';
        }
        
        // Reset n√∫t "C√≥"
        if (elements.yesButton) {
            elements.yesButton.style.transform = 'scale(1)';
        }
        
        // ƒê√≥ng t·∫•t c·∫£ popup
        if (elements.popup) elements.popup.style.display = 'none';
        if (elements.successPopup) elements.successPopup.style.display = 'none';
        if (elements.cancelPopup) elements.cancelPopup.style.display = 'none';
        if (elements.errorPopup) elements.errorPopup.style.display = 'none';
        
        // Reset scroll
        document.body.style.overflow = 'auto';
    }

    /* ========== X·ª¨ L√ù S·ª∞ KI·ªÜN ========== */

    // X·ª≠ l√Ω input message
    if (elements.messageInput && elements.submitBtn) {
        elements.messageInput.addEventListener('input', function() {
            elements.submitBtn.disabled = this.value.trim() === '';
        });
    }

    // X·ª≠ l√Ω g·ª≠i message
    if (elements.submitBtn) {
        elements.submitBtn.addEventListener('click', async function() {
            const message = elements.messageInput?.value.trim();
            if (!message) return;
            
            try {
                state.lastMessage = message; // L∆∞u tin nh·∫Øn ƒë·ªÉ c√≥ th·ªÉ th·ª≠ l·∫°i
                
                if (elements.spinner) elements.spinner.style.display = 'block';
                if (elements.submitBtn) elements.submitBtn.disabled = true;
                
                const formData = new FormData();
                formData.append('data', JSON.stringify({ message: message }));
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error('L·ªói k·∫øt n·ªëi v·ªõi server');
                }
                
                const result = await response.json();
                if (result.status !== "success") {
                    throw new Error(result.message || 'L·ªói khi l∆∞u d·ªØ li·ªáu');
                }
                
                closePopup();
                showSuccessPopup();
            } catch (error) {
                console.error('L·ªói:', error);
                // Hi·ªÉn th·ªã popup l·ªói thay v√¨ alert
                closePopup();
                showErrorPopup();
                
                // C·∫≠p nh·∫≠t th√¥ng b√°o l·ªói chi ti·∫øt
                if (elements.errorMessage) {
                    let errorText = `<strong>Anh kh√¥ng nh·∫≠n ƒë∆∞·ª£c l·ªùi nh·∫Øn c·ªßa em r·ªìi...</strong>`;
                    if (error.message.includes('server')) {
                        errorText += `<div>L·ªói k·∫øt n·ªëi v·ªõi server, em th·ª≠ l·∫°i nh√©!</div>`;
                    } else {
                        errorText += `<div>Em th·ª≠ l·∫°i l·∫ßn n·ªØa nh√©! Anh ƒë·ª£i m√† ‚ù§Ô∏è</div>`;
                    }
                    elements.errorMessage.innerHTML = errorText;
                }
            } finally {
                if (elements.spinner) elements.spinner.style.display = 'none';
                if (elements.submitBtn) elements.submitBtn.disabled = false;
            }
        });
    }

    // G√°n s·ª± ki·ªán cho n√∫t "Kh√¥ng"
    if (elements.noButton) {
        elements.noButton.addEventListener('mouseenter', handleNoButtonAction);
        elements.noButton.addEventListener('click', handleNoButtonAction);
    }

    // G√°n s·ª± ki·ªán cho n√∫t "C√≥"
    if (elements.yesButton) {
        elements.yesButton.addEventListener('click', showPopup);
    }

    // G√°n s·ª± ki·ªán ƒë√≥ng popup
    if (elements.closePopup) {
        elements.closePopup.addEventListener('click', function(e) {
            e.preventDefault();
            closePopup();
            showCancelPopup();
        });
    }
    
    // G√°n s·ª± ki·ªán cho n√∫t OK trong popup h·ªßy
    if (elements.cancelOkBtn) {
        elements.cancelOkBtn.addEventListener('click', hideCancelPopup);
    }
    
    // G√°n s·ª± ki·ªán cho n√∫t OK trong popup th√†nh c√¥ng
    if (elements.okBtn) {
        elements.okBtn.addEventListener('click', hideSuccessPopup);
    }
    
    // G√°n s·ª± ki·ªán cho n√∫t OK trong popup l·ªói
    if (elements.errorOkBtn) {
        elements.errorOkBtn.addEventListener('click', hideErrorPopup);
    }
});
    </script>
</body>
</html>